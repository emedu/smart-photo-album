<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™ºæ…§ç›¸ç°¿è‡ªå‹•éæ¿¾èˆ‡ç®¡ç†ç³»çµ±</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
  <div class="container">
    <!-- ä¸»é é¢ -->
    <div class="hero-section">
      <div class="glass-card hero-card">
        <div class="logo">
          <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
            <circle cx="40" cy="40" r="35" stroke="url(#gradient)" stroke-width="3" />
            <path d="M25 40 L35 50 L55 30" stroke="url(#gradient)" stroke-width="4" stroke-linecap="round"
              stroke-linejoin="round" />
            <defs>
              <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#667eea" />
                <stop offset="100%" style="stop-color:#764ba2" />
              </linearGradient>
            </defs>
          </svg>
        </div>

        <h1 class="title">æ™ºæ…§ç›¸ç°¿è‡ªå‹•éæ¿¾ç³»çµ±</h1>
        <p class="subtitle">AI é©…å‹•çš„ç…§ç‰‡èˆ‡å½±ç‰‡å“è³ªåˆ†æå·¥å…·</p>

        <div class="features">
          <div class="feature-item">
            <span class="icon">ğŸ”—</span>
            <span>è²¼ä¸Šç›¸ç°¿é€£çµ</span>
          </div>
          <div class="feature-item">
            <span class="icon">ğŸ¤–</span>
            <span>AI è‡ªå‹•åˆ†æ</span>
          </div>
          <div class="feature-item">
            <span class="icon">âœ¨</span>
            <span>ç”Ÿæˆç²¾é¸ç›¸ç°¿</span>
          </div>
        </div>

        <!-- ç¶²å€è¼¸å…¥å€ -->
        <div class="url-input-section" style="margin-top: 30px; width: 100%; max-width: 500px;">
          <form id="urlForm" style="display: flex; gap: 10px; flex-direction: column;">
            <input type="text" id="albumUrl" class="form-input"
              placeholder="è«‹è²¼ä¸Š Google ç›¸ç°¿åˆ†äº«é€£çµ (https://photos.app.goo.gl/...)"
              style="padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: white; width: 100%; box-sizing: border-box;"
              required>

            <button type="submit" id="analyzeBtn" class="btn btn-primary" style="width: 100%;">
              <span class="icon">âš¡</span>
              <span>é–‹å§‹è§£æèˆ‡åˆ†æ</span>
            </button>
          </form>
        </div>

        <div class="info-text">
          <p>âœ¨ æ”¯æ´å…¬é–‹æˆ–æ“æœ‰é€£çµçš„ç›¸ç°¿</p>
          <p>ğŸ”’ æ‚¨çš„ç…§ç‰‡åƒ…ç”¨æ–¼åˆ†æï¼Œä¸æœƒè¢«å„²å­˜</p>
        </div>
      </div>
    </div>

    <!-- ç‹€æ…‹è¨Šæ¯ -->
    <div id="statusMessage" class="glass-card" style="display: none; margin-top: 20px; text-align: center;">
      <div class="loader" id="loader" style="display: none;"></div>
      <p id="statusText"></p>
    </div>

    <!-- éŒ¯èª¤è¨Šæ¯ -->
    <div id="errorMessage" class="error-message" style="display: none;"></div>
  </div>

  <!-- ç§»é™¤ auth.js å¼•ç”¨ï¼Œæ”¹å¯«ç‚ºç›´æ¥è™•ç† -->
  <script>
    const form = document.getElementById('urlForm');
    const statusDiv = document.getElementById('statusMessage');
    const statusText = document.getElementById('statusText');
    const loader = document.getElementById('loader');
    const errorDiv = document.getElementById('errorMessage');
    const analyzeBtn = document.getElementById('analyzeBtn');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const url = document.getElementById('albumUrl').value.trim();

      if (!url) return;

      // Reset UI
      errorDiv.style.display = 'none';
      statusDiv.style.display = 'block';
      loader.style.display = 'inline-block';
      statusText.textContent = 'æ­£åœ¨è§£æç›¸ç°¿é€£çµï¼Œé€™å¯èƒ½éœ€è¦å¹¾ç§’é˜...';
      analyzeBtn.disabled = true;
      analyzeBtn.style.opacity = '0.7';

      try {
        const response = await fetch('/api/albums/parse', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ url })
        });

        const data = await response.json();

        if (data.success) {
          statusText.textContent = `æˆåŠŸæ‰¾åˆ° ${data.count} å¼µç…§ç‰‡ï¼æ­£åœ¨æº–å‚™åˆ†æä»‹é¢...`;

          // å„²å­˜è§£æåˆ°çš„ç…§ç‰‡åˆ° sessionStorage ä»¥ä¾¿ Dashboard ä½¿ç”¨
          sessionStorage.setItem('scrapedPhotos', JSON.stringify(data.photos));
          sessionStorage.setItem('currentAlbumTitle', 'åŒ¯å…¥çš„åˆ†äº«ç›¸ç°¿');

          setTimeout(() => {
            window.location.href = '/dashboard.html?mode=scraped';
          }, 1000);
        } else {
          throw new Error(data.error || 'è§£æå¤±æ•—');
        }
      } catch (error) {
        statusDiv.style.display = 'none';
        errorDiv.textContent = error.message || 'ç„¡æ³•è§£æé€£çµï¼Œè«‹ç¢ºèªé€£çµæ˜¯å¦æ­£ç¢ºä¸”å…¬é–‹';
        errorDiv.style.display = 'block';
      } finally {
        analyzeBtn.disabled = false;
        analyzeBtn.style.opacity = '1';
      }
    });
  </script>
</body>

</html>